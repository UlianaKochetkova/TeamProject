<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
	<head>
		<title>Chat</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
		<link rel="stylesheet" th:href="@{/css/chat_style.css}"/>
		<link rel="stylesheet" th:href="@{/css/user_style.css}"/>
		<script src="js/chat.js"></script>
	</head>
	<body>
		<div class="container-fluid h-100">
			<div class="row justify-content-center h-100">
				<div class="col-md-4 col-xl-3 chat">
					<div class="card mb-sm-3 mb-md-0 contacts_card">
					<div class="card-header">
						<div class="input-group">
							<!--	TODO: Кнопка добавления чата						-->
							<button class="input-group-text add_btn" type="submit">
								<i class="fa fa-plus" aria-hidden="true"></i>
							</button>
							<input type="text" placeholder="Search..." name="" class="form-control search">
							<div class="input-group-prepend">
								<span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
							</div>
						</div>
					</div>
					<div class="card-body contacts_body">
						<ui class="contacts" th:each="c : ${chats}">

						<li class="active">
<!--							<div class="d-flex bd-highlight" th:attr="onclick=|getChat('${c.getId()}')|">-->
							<div class="d-flex bd-highlight">
								<div class="img_cont">
									<img src="" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<div class="user_info" >
									<span th:text="${c.getTitle()}"></span>
									<p th:text="${c.getDescription()}"></p>
								</div>
							</div>
						</li>
						</ui>
					</div>
					<div class="card-footer"></div>
				</div>
				</div>

				<!--	   ШАПКА			-->
				<div class="col-md-8 col-xl-6 chat" id="chat_body">
					<div class="card">
						<div class="card-header msg_head">
							<div class="d-flex bd-highlight hd">
								<div class="chatinfo">
								<!-- Иконка чата	-->
								<div class="img_cont">
									<img src="https://www.deti.fm/vardata/modules/news/files/1/4961/news_file_4961_60dd8cd28087d.jpg" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<!-- Имя чата и количество сообщений в нём-->
								<div class="user_info">
									<span th:text="${chat.getTitle()}"></span>
									<p><span th:text="${msgs_count}"/> Messages</p>
								</div>
								</div>
								<div class="buttonsHead">
									<button th:if="${#authorization.expr('hasAuthority(''Admin'')')}" id="admin" class="input-group-text chatbut" type="submit">
										ADMIN
									</button>

									<!--	   Кнопка информации по чату			-->
									<button id="chat_info_but" class="input-group-text chatbut" type="submit">
										<i class="fa fa-comments" aria-hidden="true"></i>
									</button>
								</div>
							</div>

						</div>

						<!-- Меню тегов -->
						<div class="outtags">
						<div class="grouptags">
						<div class="tags">
							<div>
							<button th:attr="onclick=|setCurrTag(0)|"  class="tag" style="background:#ffffff;">Main</button>
							</div>
							<div>
							<button th:attr="onclick=|setCurrTag(-1)|"  class="tag" style="background:#68F914;">AntiSpam</button>
							</div>
							<div th:each="t : ${tags}">
								<button   th:attr="onclick=|setCurrTag('${t.getId()}')|"  class="tag" th:style="'background:'+ ${t.getColor()}+';'" th:text="${t.getName()}"></button>
							</div>
						</div>
						</div>
						</div>
						<!--	ЧАТ		-->
						<div class="card-body msg_card_body reversed-flex" id="msgs_body">
							<div class="d-flex mb-4" th:classappend="${#authentication.name} == ${m.getUser().getPhoneNum()} ? justify-content-end : justify-content-start" th:each="m : ${msgs}">
								<div class="msg_cotainer">
									<div class="d-flex firstline">
										<div class="topmsg">
<!--											<a class="username text-dark" th:href="@{/user/{id}(id=${m.getUser().getId()})}" th:text="${m.getUser().getUsername()}" target="_blank"></a>-->
											<a class="username text-dark" th:attr="onclick=|toUser('${m.getUser().getId()}')|" th:text="${m.getUser().getUsername()}"></a>
										</div>
										<div class="tagblock">
											<div th:each="t : ${mt.findAllByMessage_Id(m.getId())}">
												<!--<a class="round" th:style="'background:'+ ${t.getTag().getColor()}+';'" th:href="@{/tag/{id}(id=${t.getTag().getId()})}"></a>-->
												<button th:attr="onclick=|setCurrTag('${t.getTag().getId()}')|"  class="round" th:style="'background:'+ ${t.getTag().getColor()}+';'"></button>
											</div>
										</div>
									</div>
									<span th:text="${m.getText()}"></span>
									<span class="msg_time" th:text="${m.getTimeString()}"></span>
								</div>
							</div>
						</div>

						<!--	ВВОД СООБЩЕНИЯ					-->
						<div class="card-footer">
							<form id="inputForm" name="inputForm" onsubmit="getMsg(); return false;">
								<div class="input-group-append">
									<input class="form-control type_msg" type="text" id="msg" name="msg" placeholder="Enter your text here">
									<button class="input-group-text send_btn" type="submit">
										<i class="fas fa-location-arrow"></i>
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

<!--	Группировка тегов	------------------------------------------------------------------------->
		<div id="groupTags">
			<div class="background">
				<div class="back1">
					<div class="container-fluid">
						<div class="row justify-content-center">
							<div class="card-body msg_card_body">

								<h3 class="crheader"> Group Tags</h3>
								
								<form id="newTagForm" name="newTagForm" onsubmit="groupTags(); return false;">
									<label for="title" class="label">Enter name</label>
									<input class="form-control type_msg chatinput" type="text" id="title" name="title" placeholder="Tag name" required>
									<!--								Добавить выбор цвета-->
									<label for="color" class="label">Color</label>
									<input class="form-control type_msg chatinput" type="color" id="color" name="color">

									<label for="tags" class="label">Choose keywords</label>
									<select multiple id="tags" name="tags">
										<option th:each="t : ${tags}" th:value="${t.getId()}" th:text="${t.getName()}">
										</option>
									</select>

									<div class="buttons">
										<button class="input-group-text createbutton" id="back" type="reset">Back</button>
										<button class="input-group-text createbutton" id="create" type="submit">Group tags</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
<!--	Блок с информацией о чате	-->
		<div id="chat_info">
			<div class="background">
				<div class="back1">
					<div class="container-fluid">
						<div class="row justify-content-center">
							<div class="card-body msg_card_body">
								<h3 class="crheader" th:text="${chat.getTitle()}"></h3>
								<h6 class="crheader" th:text="${chat.getDescription()}"></h6>
								<hr>
								<label class="label">Users:</label>
								<ul class="border">
									<li th:each="user_chat : ${chat_users}">
										<span class="text-white" th:text="${user_chat.getUser().getUsername()}"></span>
									</li>
								</ul>

								<div class="buttons" style="justify-content: center;">
									<button class="input-group-text createbutton" id="backChat" type="reset">Back to chat</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
<!--	Блок с данными пользователя	-->
		<div id="userpage">
		</div>
	</body>
</html>
